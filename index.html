<html>
  <head>
    <meta charset="utf-8" />
    <title>Rewilding Map</title>
    <meta
      name="viewport"
      content="initial-scale=1,maximum-scale=1,user-scalable=no"
    />
    <script src="https://api.tiles.mapbox.com/mapbox-gl-js/v0.51.0/mapbox-gl.js"></script>
    <link
      href="https://api.tiles.mapbox.com/mapbox-gl-js/v0.51.0/mapbox-gl.css"
      rel="stylesheet"
    />

    <link
      href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700,600italic"
      rel="stylesheet"
      type="text/css"
    />
    <link
      rel="stylesheet"
      href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-compare/v0.1.0/mapbox-gl-compare.css"
      type="text/css"
    />

    <link href="layers/index.css" rel="stylesheet" />
    <link rel="stylesheet" href="css/colorpicker.css" type="text/css" />
    <link rel="stylesheet" href="css/layout.css" type="text/css" />
    <link href="modal/modal_styles.css" rel="stylesheet" />

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.19.1/moment.min.js"></script>
    <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-compare/v0.1.0/mapbox-gl-compare.js"></script>

    <script type="text/javascript" src="js/colorpicker.js"></script>
    <script defer src="modal/modal_script.js"></script>

    <!-- LAYERS AND TOGGLE LEGEND FUNCTIONS-->

    <script>
      /////////////////////////////
      //LAYERS AND TOGGLE LEGEND FUNCTIONS
      /////////////////////////////

      function setLayers() {
        //TOGGLE LAYERS

        var toggleableLayerIdsChecked = [];

        var toggleableLayerIdsUnchecked = [];

        //LEGEND
        var toggleLegend = document.getElementById("toggleLegend");
        while (toggleLegend.hasChildNodes()) {
          toggleLegend.removeChild(toggleLegend.lastChild);
        }

        //TOGGLING CHECKED
        for (var i = 0; i < toggleableLayerIdsChecked.length; i++) {
          //use closure to deal with scoping
          (function () {
            var id = toggleableLayerIdsChecked[i];

            //CHECKBOX
            var input = document.createElement("input");
            input.type = "checkbox";
            input.id = id;
            input.checked = true;

            //LABEL
            var label = document.createElement("label");
            label.setAttribute("for", id);
            label.textContent = id;

            //VISIBILITY (CHECKED VS. UNCHECKED)
            input.addEventListener("change", function (e) {
              map.setLayoutProperty(
                id,
                "visibility",
                e.target.checked ? "visible" : "none"
              );
            });

            //NOTE?
            var layers = document.getElementById("toggleLegend");
            layers.appendChild(input);
            layers.appendChild(label);
            layers.appendChild(document.createElement("br"));
          })();
        }

        //TOGGLING UNCHECKED
        for (var i = 0; i < toggleableLayerIdsUnchecked.length; i++) {
          //use closure to deal with scoping
          (function () {
            var id = toggleableLayerIdsUnchecked[i];

            //CHECKBOX
            var input = document.createElement("input");
            input.type = "checkbox";
            input.id = id;
            input.checked = false;

            //LABEL
            var label = document.createElement("label");
            label.setAttribute("for", id);
            label.textContent = id;

            //VISIBILITY (CHECKED VS. UNCHECKED)
            input.addEventListener("change", function (e) {
              map.setLayoutProperty(
                id,
                "visibility",
                e.target.checked ? "visible" : "none"
              );
            });

            //NOTE?
            var layers = document.getElementById("toggleLegend");
            layers.appendChild(input);
            layers.appendChild(label);
            layers.appendChild(document.createElement("br"));
          })();
        }
      }

      //LAYER SWITCHING
      function switchStyle() {
        var basemaps = document.getElementById("styleSwitcher");
        var inputs = basemaps.getElementsByTagName("input");
        console.log(inputs);
        console.log(inputs.length);

        for (var i = 0; i < inputs.length; i++) {
          inputs[i].onclick = switchLayer;
        }
      }
    </script>
  </head>

  <body>
    <!------------------------------------->
    <!--CLICK ON ABOUT, OPEN MODAL DIALOG-->
    <!------------------------------------->

    <div class="modal" id="modal">
      <div class="modal-header">
        <div class="title" id="modal-title" >About</div>
        <button data-close-button class="close-button">&times;</button>
      </div>
      <div class="modal-body">
        While our landscape has been ravaged, with the little left wild
        scattered, it turns out that wildlife areas can be connected and
        expanded, and new ones created in a way that is achievable and
        practical. The land closest to rivers is often the highest value for
        cores and corridors, and has the lowest land value, with steep slopes,
        loose ground, and regular flooding. As water connects the breadth of
        land and all life, cores and corridors form the body and veins of
        wildlife habitats. They would also need the least effort with the most
        benefit in preventing chemical runoff that has poisoned water and in
        protecting and restoring precious soil that has been washing away and
        destroying land.
        <p>
          This map is an indispensable for establishing wildlife cores and
          corridors. It shows colored slopes, floodplains, and cropland that are
          swiped back and forth for comparison with a satellite photograph that
          makes the landscape visible at a given point in time. It reveal
          potentials otherwise unseen, with the areas that are most suitable for
          expansion and creation of core and corridor habitats, and they display
          or suggest strategic and viable connections between them for wildlife
          to cross. More easily than ever, people can know where to look, where
          they would then walk and assess the land in person.
        </p>

        <p></p>
        <hr />
        <font size="4.5"> <b>Outline of Map Layers:</b></font>

        <p>
          <img src="modal/map_elements.jpg" width="100%" />
        </p>
      </div>
    </div>

    <div id="overlay"></div>

    <!-------------------->
    <!--ADD HEADER DIV---->
    <!-------------------->

    <div class="header">
      <a href="https://bewildrewild.org/">
        <img
          style="padding: 6px 8px 0px 20px; float: left;"
          src="logo/Big-River-Connectivity-and-BeWildReWild-Logo.png"
          height="55"
          align="middle"
        />
      </a>

      <div id="header_text" class="headerText">
        <a href="" class="selflink"> | Rewilding Map</a>
      </div>

      <div class="header-right">
        <!--About dialog button, opens modal-->
		<button id="modal-button" style="display: none;" data-modal-target="#modal">Modal</button>
        <!--<button class="button" id="start-modal2" >Guide</button>-->
        

        <button class="button"><a href="https://docs.google.com/document/d/e/2PACX-1vQ7NvezCmnr4OafWMBydExtB4ccYywsq71iqpNZfNpnLqeabOLRTuiW2i-tTboZIyoYpDXuQQSRINgE/pub?embedded=true" target="_blank">Map Guide</a>


        <!--<a href="#">About</a> -->
        <!--
        <button id="modal-button" style="display: none;" data-modal-target="#modal">Modal</button>
        <button class="button" id="start-modal" >About</button>
        -->

      </div>
    </div>

    <!-------------------->
    <!--ADD MAP DIVS---->
    <!-------------------->

    <div id="studioMenu">
      <p class="title">
        LAYERS
      </p>
      <!-- <p class="description">
            Land that is steep or floods often is the least valuable land
            and often the most valuable for rewilding. Follow the 1000ft
            minimum corridor that surrounds rivers to see how the land
            looks underneath.
        </p> -->
	  
	  <!--
      <div id="studioMenuLayerEdit" class="disabled">
        <p class="title"></p>
        <span id="studioInfoIcon" class="layer-edit-icon">
          <svg id="icon-database" viewBox="0 0 18 18" style="width: 20px;">
            <path
              d="M9 3.5c-2.8 0-5 .9-5 2V6c0 1.1 2.2 2 5 2s5-.9 5-2v-.5c0-1.1-2.2-2-5-2zm-4.8 5c-.1 0-.2.2-.2.5v.5c0 1.1 2.2 2 5 2s5-.9 5-2V9c0-.6-.3-.7-.8-.4-.1 0-.1.1-.2.1-.9.5-2.3.8-4 .8s-3.1-.3-4-.8c0 0-.1 0-.2-.1-.2-.1-.4-.2-.6-.1zm0 3.5c-.1 0-.2.2-.2.5v.5c0 1.1 2.2 2 5 2s5-.9 5-2v-.5c0-.6-.3-.7-.8-.4-.1 0-.1.1-.2.1-.9.5-2.3.8-4 .8s-3.1-.3-4-.8c-.1 0-.1-.1-.2-.1-.2-.1-.4-.2-.6-.1z"
            ></path>
          </svg>
        </span>
        <span id="studioDisableIcon" class="layer-edit-icon">
          <svg viewBox="0 0 18 18" style="width: 20px;">
            <path
              d="M4 10s.6-1.5 2-2.4c0 0 1.1-.6 2-.8L9.6 5H8c-4 0-6 5-6 5s.6 1.1 1.7 2.1c.1-.3.2-.5.4-.8l.6-.7c-.4-.3-.7-.6-.7-.6zM11.9 5h-.1c-.2 0-.4.2-.6.3l-6 7c-.4.4-.4 1.1 0 1.5s1.1.3 1.5-.2l6-7c.6-.5 0-1.7-.8-1.6zM14.2 7.2c-.1.2-.2.3-.3.4l-.8.9c.6.8.9 1.5.9 1.5s-2 2.5-4 2.5h-.3L8.4 14H10c4 0 6-4 6-4s-.6-1.5-1.8-2.8z"
            ></path>
          </svg>
        </span>
        <span id="studioVisibleIcon" class="layer-edit-icon display-none">
          <svg viewBox="0 0 18 18" style="width: 20px;">
            <path
              d="M8 4C4 4 2 9 2 9s2 4 6 4h2c4 0 6-4 6-4s-2-5-6-5H8zM6 6.6V7c0 1.2.8 2.3 1.8 2.8h.1c.2.1.3.1.5.2H9c.4 0 .8-.1 1.2-.2 1-.5 1.8-1.6 1.8-2.8v-.4c1.5.9 2 2.4 2 2.4s-2 2.5-4 2.5H8C6 11.5 4 9 4 9s.6-1.5 2-2.4z"
            ></path>
          </svg>
        </span>
		-->
        <!-- <span id="studioRemoveIcon" class="layer-edit-icon">
                <svg id="icon-trash" viewBox="0 0 18 18" style="width: 20px"><path d="M7 3C6 3 6 4 6 4v1H5S4 5 4 6s1 1 1 1h8s1 0 1-1-1-1-1-1h-1V4s0-1-1-1H7zm0 1h4v1H7V4zM5 9v5s0 1 1 1h6s1 0 1-1V9c0-1-1-1-1-1H6C5 8 5 9 5 9z"></path></svg>
            </span> -->
	  <!-- </div> -->
      <ul id="studioLayerGroup"></ul>
      <!-- <div>
            <div class="layer-group">
                <img src="https://www.thenittygritty.org/wildlifecorridors/map_keys/corridors.png" style="width:10px;height:10px;">
                <img src="https://www.thenittygritty.org/wildlifecorridors/map_keys/lines.png" style="width:10px;height:10px;">
                Corridors (1000ft)</div>
            <div>
                <img src="https://www.thenittygritty.org/wildlifecorridors/map_keys/cores.png" style="width:10px;height:10px;">
                <img src="https://www.thenittygritty.org/wildlifecorridors/map_keys/shapes.png" style="width:10px;height:10px;">
                Cores</div>
            <div>
                <img src="https://www.thenittygritty.org/wildlifecorridors/map_keys/Mainflow.png" style="width:10px;height:10px;">
                <img src="https://www.thenittygritty.org/wildlifecorridors/map_keys/lines.png" style="width:10px;height:10px;">
                Rivers and Creeks</div>
            <div>
                <img src="https://www.thenittygritty.org/wildlifecorridors/map_keys/flowlines.png" style="width:10px;height:10px;">
                <img src="https://www.thenittygritty.org/wildlifecorridors/map_keys/lines.png" style="width:10px;height:10px;">
                Flowlines</div>
            <div>
                <img src="https://www.thenittygritty.org/wildlifecorridors/map_keys/waterbodies.png" style="width:10px;height:10px;">
                <img src="https://www.thenittygritty.org/wildlifecorridors/map_keys/shapes.png" style="width:10px;height:10px;">
                Waterbodies</div>
            <div>
                <img src="https://www.thenittygritty.org/wildlifecorridors/map_keys/floodplain_5_yr.png" style="width:10px;height:10px;">
                <img src="https://www.thenittygritty.org/wildlifecorridors/map_keys/shapes.png" style="width:10px;height:10px;">
                Flood Plain (5 Year)</div>
            <div>
                <img src="https://www.thenittygritty.org/wildlifecorridors/map_keys/slope_5_9.png" style="width:10px;height:10px;">
                <img src="https://www.thenittygritty.org/wildlifecorridors/map_keys/shapes.png" style="width:10px;height:10px;">
                Slope: 5-9%</div>
            <div>
                <img src="https://www.thenittygritty.org/wildlifecorridors/map_keys/slope_9_plus.png" style="width:10px;height:10px;">
                <img src="https://www.thenittygritty.org/wildlifecorridors/map_keys/shapes.png" style="width:10px;height:10px;">
                Slope: 9% Plus</div>
        </div> -->
    </div>
    <div id="before" class="map"></div>
    <div id="map" class="map"></div>

    <!--STYLE SWITCHER-->
    <div id="styleSwitcher"></div>

    <!--TOGGLE LAYERS-->
    <nav id="toggleLegend" class="display-none"></nav>

    <!--TOGGLE MENU-->
    <nav id="menu" class="display-none"></nav>

    <!--TOGGLE MENU-->
    <nav id="menu2" class="display-none"></nav>

    <!--BASEMAP TOGGLE-->
    <div id="basemapmenu">
      <!--SATELLITE-->
      <input
        id="ck0sihu5wer5p1crswvqheao7"
        type="radio"
        name="rtoggle"
        value="ck0sihu5wer5p1crswvqheao7"
        checked="checked"
      />
      <label for="ck0sihu5wer5p1crswvqheao7">Satellite (Default)</label>

      <p>
        <!--SATELLITE STREETS-->
        <input
          id="ck3b0975s1p581clsra6w992w"
          type="radio"
          name="rtoggle"
          value="ck3b0975s1p581clsra6w992w"
        />
        <label for="ck3b0975s1p581clsra6w992w">Human Labels</label>
      </p>
    </div>

    <!--ADD MAPS TO COMPARE-->
    <script>
      mapboxgl.accessToken =
        "pk.eyJ1Ijoibml0dHlqZWUiLCJhIjoiY20waDRsYWVmMDdoMDJscTRmMTB1NWJhdCJ9.Y9Y5qPNB5bviltf6cVG1uA";

      //Satellite Map
      var beforeMap = new mapboxgl.Map({
        container: "before",
        //With Labels
        //style: 'mapbox://styles/nittyjee/ck3azcbul18sv1dmgni6bw44o',
        //Without Labels
        style: "mapbox://styles/nittyjee/ck0sihu5wer5p1crswvqheao7",
        center: [-102.03, 38.19],
        hash: true,
        zoom: 3.91,
      });

      //Overlay Map
      var map = new mapboxgl.Map({
        container: "map",
        style: "mapbox://styles/nittyjee/ck312iiwh1jmy1cpmq51odz7o",

        //Map with labels
        //Note how labels do not appear because of other layers
        //style: 'mapbox://styles/nittyjee/ck36wxmuu3dif1cqr50vesar9',

        hash: true,
        zoom: 3.91,
        center: [-102.03, 38.19],
      });

      //ADDING HOVER STUFF
      var hoveredStateId = null;

      //BASEMAP MENU SWITCHING FUNCTIONALITY
      var layerList = document.getElementById("basemapmenu");
      var inputs = layerList.getElementsByTagName("input");

      function switchLayer(layer) {
        var layerId = layer.target.id;

        //MY LINE:
        beforeMap.setStyle("mapbox://styles/nittyjee/" + layerId);

        //ORIGINAL LINE:
        //map.setStyle('mapbox://styles/mapbox/' + layerId);
      }

      for (var i = 0; i < inputs.length; i++) {
        inputs[i].onclick = switchLayer;
      }

      /////////////////////////////
      //ADD NAVIGATION CONTROL (ZOOM IN AND OUT)
      /////////////////////////////

      //Before map
      var nav = new mapboxgl.NavigationControl();
      beforeMap.addControl(nav, "bottom-right");

      //After map
      var nav = new mapboxgl.NavigationControl();
      map.addControl(nav, "bottom-right");

      var layerGroup = [];
      
	  var layerColors = [];

	  var popupModalHTMLs = [];
	  
    popupModalHTMLs["Rewilding Priority Land Cover (RPLC)"] = "This layer is merged from land cover layers below, which you can find in the sidebar. If you zoom in very closely, it follows the landscape with very fine resolution, down to meters. Area within a 1 mile boundary of city limits are excluded. For more information, read the section of the guide on Land Cover Layers.</span></p><hr /><p><b>Land Cover Layers Used:</b></p><p><span>*Forest Land<br /></span><span>*Water<br /></span><span>*Wetlands<br /></span><span>*Shrubland<br /></span><span>*Grassland and Pasture<br /></span><span>*Hay<br /><br /></span></p><p><b>Land Cover Layers Excluded:</b></p><p><span>*Developed<br /></span><span>*Crops</span></p><hr /><p><b>Source(s):</b><b><br /></b></p><p><span>See sections:</span></p><p><span>*Land cover layers</span><span><br /></span><span>*City limits.</span></p>";
    popupModalHTMLs["RPLF: Rewilding Priority Land with Floodplains"] = "This layer expands the Rewilding Priority Land Cover (RPLC) layer, and adds floodplains.</p><p>This layer also has a 'hover' function, where you can click a hover button and mouse over the RPLF areas and highlight them and see how many acres they cover.</p><p><br /><strong>Sources:</strong></p><p>This layer was created from the following layers, read their sections:<br />*Rewilding Priority Land Cover (RPLC)<br />- via Land Cover Layers <br />*City limits.<br />*Floodplains</p>";
    popupModalHTMLs["Main Corridor lines"] = "Along with Rewilding Priority Land (RPL), which is used to locate potential cores, the Main Corridor Lines are the other half, for locating potential corridors. The Main Corridor Lines focus on connecting the largest RPLA areas to create a cohesive vision of a rewilded Iowa.</p><p><br />The Main Corridor Lines are drawn to have the shortest connections over the least amount of farmland. Their paths follow several other layers in a nuanced hierarchy:</p><p>*Larger RPLF areas are given greater priority than smaller ones.<br />*RPLC land is given priority over RPLF land, except for 5-year floodplains.<br />*Land that has wider spaces is given priority over land where the area may be greater, but spaces are thin. Ideally space should be at least 2000 feet wide for wildlife to travel.<br />*Existing cores that are dedicated to wildlife are given high priority. Some land may have less area but contain a core, and it may be better to route through the core.</p><p><br />The Main Corridor Lines are made of 3 features:<br />*Lines over RPL (Orange)<br />*Lines over farmland (Red)<br />*Points of short connection across farmland (Red)</p><p><br />The process of drawing potential corridors is iterative, as the land is observed more closely and surveyed, and as corridors and cores are created.</p><p>&nbsp;</p><p><strong>Source(s):</strong></p><p>This layer was drawn with the use of all other layers except the Regions layers.</p>";
    popupModalHTMLs["Cores"] = "This layer is are of two types:</p><p><strong><br />Existing Cores:</strong> These are existing public lands within Iowa. Some dedicated to wildlife, while some are for human recreation and may not actually serve as cores.</p><p><strong>Drawn Cores:</strong> These were roughly drawn outside of Iowa, where the Rewilding Priority Land (RPL) layers weren't generated. They are helpful for defining the edges of the directions we want to move towards, and gives a regional context.</p><p>There are also label layers you can turn on and off.</p><p>Currently these are two sets of layers with several others, which may in the future be merged.</p><p><br /><strong>Source(s):</strong></p><p>*Iowa Department of Natural Resources (IDNR)<br />*Drawn cores: Leland Searles, conservationist with BewildRewild.</p>";
    popupModalHTMLs["Flowlines"] = "Flowlines are along where water flows, from where water collects, to streams and rivers. The whole Mississippi Watershed is shown. These form the outlines of the broader vision of 'Big River Connectivity'. The lines are given an equal width, as to not emphasize one area over the other. At different zoom levels you see different lines - more branches appear as you zoom further. This layer is very precise, down to a few meters.</p><p><br /><strong>Source(s):</strong><br />*National Hydrological Dataset (NHD)";
    popupModalHTMLs["City Limits"] = "City limits are to be avoided for wildlife cores and corridors, so Rewilding Priority Lands are excluded there, with a generated 1-Mile boundary. A 1-mile boundary is a 15-20 minute walk from generally sparsely populated edges of towns. It does not include unincorporated communities.</p><p><br /><strong>Source(s):</strong><br />State of Iowa</p>";
    popupModalHTMLs["Corridors"] = "As rivers are central to the connectivity for rewilding, corridors were created following flowlines and waterbodies that are wide enough for wildlife to travel. The corridors generated were 1000 feet on each side (2000 feet total).</p><p>The land along rivers are generally low value because they are steep and unsuitable for farmland, but are high value for wildlife. Furthermore, rewilding along rivers will vastly reduce chemical runoff. Water corridors are in the general direction that wildlife corridors would ultimately be placed.<br /><br /></p><p><strong>Source(s):</strong></p><p>This layer was derived from:<br />*Flowlines<br />*Waterbodies</p>";
    popupModalHTMLs["Waterbodies"] = "Larger bodies of water, such as lakes and very wide rivers are included as a separate layer, as flowlines are too thin. The flowlines and waterbody areas are together used to generate the corridors layer. The 'Water' and 'Wetlands' Land Cover Layers can also be used to see the water boundaries.</p><p><strong><br />Source(s):</strong><br />National Hydrological Dataset (NHD)</p>";
    popupModalHTMLs["Bridges"] = "Often Rewilding Priority Land (RPL) is cut off by highways and rail paths, and will need wildlife crossings. This layer includes all the road and rail bridges in Iowa, which are often the most effective places to place crossings.</p><p><strong><br />Source(s):</strong><br />*National Bridge Inventory (NBI)</p>";
    popupModalHTMLs["Floodplains"] = "These layers include 5-year floodplains, 25-year floodplains, and 500-year floodplains.</p><p>A 5-year floodplain is of low value for agriculture, and once you get past a 25-year floodplain, the value is more loosely affected. The 500-year floodplains give an idea of the full extent of floodplains, and were included mainly because the data was unfortunately limited.</p><p>These layers come from 2 datasets, from the Iowa Flood Center (IFC), which is very high quality, but is also mixed with federal data, which is very low quality. Both do not cover some areas that the others don't, and both together don't cover the full extent of Iowa.</p><p>Though the land that floods infrequently more loosely affects farmland value, it was still included in the Rewilding Priority Land with Floodplains (RPLF) layer, because it showed large areas emerge, and give an idea of their full extent. Very large areas that flood very infrequently have flooded in recent years, such as the Loess Hills area of western Iowa, and the frequency of flooding may be increasing with climate change.</p><p>When using the RPLF layer, you can see how it interacts with the RPLC layer by keeping the floodplain layers and city limits layer on underneath, and turn the the RPLF layer on and off.</p><p><br /><br /></p><p><strong>Layers:</strong></p><p>*5-YR (IFC)<br />*25-YR (IFC)<br />*25-YR (Federal)<br />*25-500YR (IFC &amp; Federal): Some Iowa Flood Center (IFC) data mixes federal data.</p><p>&nbsp;</p><p><strong>Sources:</strong></p><p>*Iowa Floodplain Center (IFC)<br />*Federal Emergency Management Agency (FEMA)</p><p>Read more in detailed guide.</p>";
    popupModalHTMLs["Land Cover Layers"] = "This is a set of layers that show precise land cover, down to meters in precision, as small as backyards and gardens. They are grouped from layers that are generated from satellite data, including over a hundred different types of crops.</p><p>They were grouped into the following categories:</p><p>*Forest Land<br />*Water<br />*Wetlands<br />*Shrubland<br />*Grassland and Pasture<br />*Hay<br />*Developed<br />*Crops</p><p><br /><strong>Source(s):</strong><br />Cropscape, USDA</p>";
    popupModalHTMLs["Regions"] = "A current approach is to divide Iowa into sections that regional groups will rewild, with equal Rewilding Priority Land and focus. The total limit is 9 million acres, divided into 4 regions, with a maximum of 2.25 million acres for each.</p><p>&nbsp;</p><p><strong>Cores Quads:</strong> This is Rewilding Priority Land with Floodplains (RPLF) that's within the highway quadrants, with the largest cores that add up to 2.25 million. As you can see, many pieces are missing in the quadrants with more RPLF land, while quadrants don't add up to 2.25 million acres, so all the RPLF in those quadrants are intact.</p><p><strong>Quadrants:</strong> The quadrant lines for the Cores Quads layer, divided by human use, by highways I-35 and I-80.</p><p><strong>SE Quadrant:</strong> This is an attempt at defining quadrants more, this time by watersheds (Hydrological Units). One area is used, that will also be more focused on the area with the greatest concentration of RPLF land, and allow there to be more of a distribution of land between quadrants.</p><p><br /><strong>Source(s):</strong></p><p>State of Iowa<br />Federal Tigerlines<br />Iowa/NHD Hydrological Units (Hydrological Unit Codes, HUCS)</p>";
      

      /////////////////////////////
      //LAYER CHANGING
      /////////////////////////////

      //BASEMAP SWITCHING
      map.on("style.load", function () {
        //on the 'style.load' event, switch "basemaps" and then re-add layers
        //this is necessary because basemaps aren't a concept in Mapbox, all layers are added via the same primitives
        console.log("style change");
        switchStyle();
        var sliderVal = $("#date").val();
        var yr = parseInt(moment.unix(sliderVal).format("YYYY"));
        var date = parseInt(moment.unix(sliderVal).format("YYYYMMDD"));
        console.log(sliderVal);
        console.log(yr);
        console.log(date);
        setLayers();
        addLayers(yr, date);
      });

      /////////////////////////////
      //MAP LAYERS
      /////////////////////////////

      //////////////////////////////
      //TOP LAYERS
      //////////////////////////////

      map.on("load", function () {
        /////////////
        //FOREST
        /////////////

        map.addSource("Forest Land", {
          type: "vector",
          url: "mapbox://nittyjee.5t66rftj",
        });
        map.addLayer({
          id: "Forest Land",
          type: "fill",
          source: "Forest Land",
          layout: {
            visibility: "visible",
          },

          "source-layer": "forest_all_iowa",

          paint: {
            "fill-color": "#5b9322",
            "fill-opacity": {
              stops: [
                [5.2, 0],
                [5.7, 1],
                [5.71, 0],
                [7.9, 0],
                [8.0, 1],
                [11.6, 1],
                [12.3, 0],
              ],
            },
          },
        });

        /////////////
        //ALL CROPS
        /////////////

        map.addSource("Crops", {
          type: "vector",
          url: "mapbox://nittyjee.40faz9sy",
        });
        map.addLayer({
          id: "Crops",
          type: "fill",
          source: "Crops",
          layout: {
            visibility: "visible",
          },

          "source-layer": "all_crops_all_iowa",

          paint: {
            "fill-color": "#d0f0d2",
            "fill-opacity": {
              stops: [
                [5.2, 0],
                [5.7, 1],
                [5.71, 0],
                [7.9, 0],
                [8.0, 1],
                [11.6, 1],
                [12.3, 0],
              ],
            },
          },
        });

        /////////////
        //ALL WATER
        /////////////

        map.addSource("Water", {
          type: "vector",
          url: "mapbox://nittyjee.absudjmp",
        });
        map.addLayer({
          id: "Water",
          type: "fill",
          source: "Water",
          layout: {
            visibility: "visible",
          },

          "source-layer": "water_all_iowa",

          paint: {
            "fill-color": "#363aba",
            "fill-opacity": {
              stops: [
                [5.2, 0],
                [5.7, 1],
                [5.71, 0],
                [7.9, 0],
                [8.0, 1],
                [11.6, 1],
                [12.3, 0],
              ],
            },
          },
        });

        /////////////
        //WETLANDS
        /////////////

        map.addSource("Wetlands", {
          type: "vector",
          url: "mapbox://nittyjee.c4vtckr8",
        });
        map.addLayer({
          id: "Wetlands",
          type: "fill",
          source: "Wetlands",
          layout: {
            visibility: "visible",
          },

          "source-layer": "wetlands_all_iowa",

          paint: {
            "fill-color": "#65adc1",
            "fill-opacity": {
              stops: [
                [5.2, 0],
                [5.7, 1],
                [5.71, 0],
                [7.9, 0],
                [8.0, 1],
                [11.6, 1],
                [12.3, 0],
              ],
            },
          },
        });

        /////////////
        //DEVELOPED
        /////////////

        map.addSource("Developed", {
          type: "vector",
          url: "mapbox://nittyjee.3yku7zdf",
        });
        map.addLayer({
          id: "Developed",
          type: "fill",
          source: "Developed",
          layout: {
            visibility: "visible",
          },

          "source-layer": "developed_all_iowa",

          paint: {
            "fill-color": "#000000",
            "fill-opacity": {
              stops: [
                [5.2, 0],
                [5.7, 1],
                [5.71, 0],
                [7.9, 0],
                [8.0, 1],
                [11.6, 1],
                [12.3, 0],
              ],
            },
          },
        });

        /////////////
        //SHRUBLAND
        /////////////

        map.addSource("Shrubland", {
          type: "vector",
          url: "mapbox://nittyjee.9ooya6u3",
        });
        map.addLayer({
          id: "Shrubland",
          type: "fill",
          source: "Shrubland",
          layout: {
            visibility: "visible",
          },

          "source-layer": "shrubland_all_iowa",

          paint: {
            "fill-color": "#beb297",
            "fill-opacity": {
              stops: [
                [5.2, 0],
                [5.7, 1],
                [5.71, 0],
                [7.9, 0],
                [8.0, 1],
                [11.6, 1],
                [12.3, 0],
              ],
            },
          },
        });

        /////////////
        //GRASSLAND AND PASTURE
        /////////////

        map.addSource("Grassland and Pasture", {
          type: "vector",
          url: "mapbox://nittyjee.agfuorgj",
        });
        map.addLayer({
          id: "Grassland and Pasture",
          type: "fill",
          source: "Grassland and Pasture",
          layout: {
            visibility: "visible",
          },

          "source-layer": "grassland_pasture_all_iowa",

          paint: {
            "fill-color": "#b2c34f",
            "fill-opacity": {
              stops: [
                [5.2, 0],
                [5.7, 1],
                [5.71, 0],
                [7.9, 0],
                [8.0, 1],
                [11.6, 1],
                [12.3, 0],
              ],
            },
          },
        });

        /////////////
        //HAY
        /////////////

        map.addSource("Hay", {
          type: "vector",
          url: "mapbox://nittyjee.05xe7wt8",
        });
        map.addLayer({
          id: "Hay",
          type: "fill",
          source: "Hay",
          layout: {
            visibility: "visible",
          },

          "source-layer": "alfalfa_and_nonalflalfa_hay_all_iowa",

          paint: {
            "fill-color": "#e5b636",
            "fill-opacity": {
              stops: [
                [5.2, 0],
                [5.7, 1],
                [5.71, 0],
                [7.99, 0],
                [8.0, 1],
                [11.6, 1],
                [12.3, 0],
              ],
            },
          },
        });

        /////////////
        //FLOODPLAINS
        /////////////

        /////////////
        //FLOODPLAIN, FEDERAL
        /////////////

        map.addSource("federal_25yr", {
          type: "vector",
          url: "mapbox://nittyjee.c1bl5si7",
        });
        map.addLayer({
          id: "federal_25yr",
          type: "fill",
          source: "federal_25yr",

          layout: {
            visibility: "visible",
          },

          "source-layer": "federal_25yr",
          paint: {
            "fill-color": "#dc3eaf",
            "fill-opacity": {
              stops: [
                [8, 0],
                [9, 1],

                /*May be more ideal:            
                            [7, 0],
                            [8, 1]
                            */
              ],
            },
          },
        });

        /////////////
        //FLOODPLAIN, IOWA FLOOD CENTER, 25-500YR
        /////////////

        map.addSource("IFC_Floodplain 25_500YR", {
          type: "vector",
          url: "mapbox://nittyjee.a3hreb9k",
        });
        map.addLayer({
          id: "IFC_Floodplain 25_500YR",
          type: "fill",
          source: "IFC_Floodplain 25_500YR",

          layout: {
            visibility: "visible",
          },

          "source-layer": "25_500",
          paint: {
            "fill-color": "#dc3eaf",
            "fill-opacity": {
              stops: [
                [8, 0],
                [9, 1],

                /*May be more ideal:            
                            [7, 0],
                            [8, 1]
                            */
              ],
            },
          },
        });

        /////////////
        //FLOODPLAIN, IOWA FLOOD CENTER, 25YR
        /////////////

        map.addSource("IFC_Floodplain", {
          type: "vector",
          url: "mapbox://nittyjee.24kmsjzg",
        });
        map.addLayer({
          id: "IFC_Floodplain",
          type: "fill",
          source: "IFC_Floodplain",

          layout: {
            visibility: "visible",
          },

          "source-layer": "ifc_25yr",
          paint: {
            "fill-color": "#dc9a00",
            "fill-opacity": {
              stops: [
                [8, 0],
                [9, 1],

                /*May be more ideal:            
                            [7, 0],
                            [8, 1]
                            */
              ],
            },
          },
        });

        /////////////
        //FLOODPLAIN, IOWA FLOOD CENTER, 5YR
        /////////////

        map.addSource("5yr", {
          type: "vector",
          url: "mapbox://nittyjee.buz7mlca",
        });
        map.addLayer({
          id: "5yr",
          type: "fill",
          source: "5yr",

          layout: {
            visibility: "visible",
          },

          "source-layer": "5yr",
          paint: {
            "fill-color": "#8ec7d3",
            "fill-opacity": {
              stops: [
                [8, 0],
                [9, 1],

                /*May be more ideal:            
                            [7, 0],
                            [8, 1]
                            */
              ],
            },
          },
        });

        /////////////
        //NONPRODUCTIVE LAND
        /////////////

        map.addSource("Cores", {
          type: "vector",
          url: "mapbox://nittyjee.8q3k2e1q",
        });
        map.addLayer({
          id: "Rewilding Priority Land Cover (RPLC)",
          type: "fill",
          source: "Cores",
          layout: {
            visibility: "visible",
          },

          "source-layer": "nonprod",

          paint: {
            "fill-color": {
              property: "acres",
              stops: [
                [0, "#b5de93"],
                [9999, "#b5de93"],
                [10000, "#82cd4f"],
                [1000000, "#82cd4f"],
              ],
            },

            "fill-opacity": {
              stops: [
                [5.2, 0],
                [5.21, 1],
                /*
                            [5.7, 1],
                            [5.71, 0],
                            [7.9,0],
                            
                            [8.0,1],
                            */
                [11.6, 1],
                [12.3, 0],
              ],
            },
          },
        });

        /////////////
        //NONPRODUCTIVE LAND WITH FLOODPLAINS
        /////////////

        map.addSource("Cores With Floodplains", {
          type: "vector",
          url: "mapbox://nittyjee.dawues7i",
        });
        map.addLayer({
          id: "RPLF: Rewilding Priority Land with Floodplains",
          type: "fill",
          source: "Cores With Floodplains",
          layout: {
            visibility: "visible",
          },

          "source-layer": "nonprod_floodplains",

          paint: {
            "fill-color": {
              property: "acres",
              stops: [
                [0, "#b5de93"],
                [9999, "#b5de93"],
                [10000, "#82cd4f"],
                [1000000, "#82cd4f"],
              ],
            },

            "fill-opacity": {
              stops: [
                [5.2, 0],
                [5.21, 1],
                /*
                            [5.7, 1],
                            [5.71, 0],
                            [7.9,0],
                            
                            [8.0,1],
                            */
                [11.6, 1],
                [12.3, 0],
              ],
            },
          },
        });


            /////////////
            //NONPRODUCTIVE LAND QUADS
            /////////////

            map.addSource('Cores Quads', {
                type: 'vector',
                url: 'mapbox://nittyjee.ay6ojc2k'
            });
            map.addLayer({
                'id': 'Cores Quads',
                'type': 'fill',
                'source': 'Cores Quads',
                'layout': {
                    'visibility': 'none'
                },

                "source-layer": "nonprod_quad",

                paint: {

                    'fill-color': {
                        property: '2_5_mill',
                        type: 'categorical',
                        stops: [
                            ['0', '#ffffff'],
                            ['1', '#82cd4f']
                        ]
                    },

                    "fill-opacity": {
                        stops: [
                            [5.2, 0],
                            [5.21, 1],
                            /*
                            [5.7, 1],
                            [5.71, 0],
                            [7.9,0],
                            
                            [8.0,1],
                            */
                            [11.6, 1],
                            [12.3, 0]
                        ]
                    }

                }

            });

        /////////////
        //NONPRODUCTIVE LAND WITH FLOODPLAINS
        /////////////

        map.addLayer({
          id: "Cores With Floodplains Hover",
          type: "fill",
          source: "Cores With Floodplains",

          layout: {
            visibility: "visible",
          },
          paint: {
            "fill-color": "#000000",
            "fill-opacity": [
              "case",
              ["boolean", ["feature-state", "hover"], false],
              1,
              0,
            ],
          },
        });

        /////////////
        //LELAND OUTSIDE IOWA LINES
        /////////////

        map.addSource("Leland Outside Iowa Lines", {
          type: "vector",
          url: "mapbox://nittyjee.byknmy4i",
        });
        map.addLayer({
          id: "Leland Outside Iowa Lines",
          type: "line",
          source: "Leland Outside Iowa Lines",

          layout: {
            visibility: "visible",
          },

          "source-layer": "leland_outside_lines-6v6ftu",
          paint: {
            "line-color": "#b5d076",
            "line-opacity": {
              stops: [
                [4, 0],
                [5, 1],
              ],
            },
          },
        });

        /////////////
        //LELAND MISSOURI
        /////////////

        map.addSource("Leland Missouri", {
          type: "vector",
          url: "mapbox://nittyjee.4nrj6b38",
        });
        map.addLayer({
          id: "Leland Missouri",
          type: "fill",
          source: "Leland Missouri",

          layout: {
            visibility: "visible",
          },

          "source-layer": "leland_missouri-c6jz6o",
          paint: {
            "fill-color": "#82cd4f",
            "fill-opacity": {
              stops: [
                [5, 0],
                [5.2, 1],
              ],
            },
          },
        });

        /////////////
        //LELAND OUTSIDE
        /////////////

        map.addSource("Leland Outside Iowa", {
          type: "vector",
          url: "mapbox://nittyjee.5fx5p117",
        });
        map.addLayer({
          id: "Leland Outside Iowa",
          type: "fill",
          source: "Leland Outside Iowa",

          layout: {
            visibility: "visible",
          },

          "source-layer": "leland_outside-db61ef",
          paint: {
            "fill-color": "#82cd4f",
            "fill-opacity": {
              stops: [
                [4, 0],
                [4.5, 1],
              ],
            },
          },
        });

        /////////////
        //LELAND LOESS HILLS ADDITION
        /////////////

        map.addSource("Leland Loess Hills Addition", {
          type: "vector",
          url: "mapbox://nittyjee.crvajd16",
        });
        map.addLayer({
          id: "Leland Loess Hills Addition",
          type: "fill",
          source: "Leland Loess Hills Addition",

          layout: {
            visibility: "visible",
          },

          "source-layer": "loess_hills_addition_leland-1686l5",
          paint: {
            "fill-color": "#82cd4f",
            "fill-opacity": {
              stops: [
                [5, 0],
                [5.2, 1],
              ],
            },
          },
        });

        /////////////
        //LELAND OUTSIDE LABELS
        /////////////

        map.addSource("Leland Outside Labels", {
          type: "vector",
          url: "mapbox://nittyjee.admkqgei",
        });

        map.addLayer({
          id: "Leland Outside Labels",
          type: "symbol",
          source: "Leland Outside Labels",

          layout: {
            visibility: "visible",
          },

          layout: {
            "text-field": "{Name}",
            "text-size": {
              stops: [
                [11, 10],
                [12, 12],
              ],
            },
          },

          "source-layer": "leland_outside-d8mcrt",

          paint: {
            "text-halo-color": "#ffffff",
            "text-halo-width": 5,
            "text-opacity": {
              stops: [
                [8, 0],
                [9, 1],
              ],
            },
          },
        });

        /////////////
        //LELAND LOESS HILLS ADDITION LABELS
        /////////////

        map.addSource("Leland Loess Hills Addition Labels", {
          type: "vector",
          url: "mapbox://nittyjee.59lf97l3",
        });

        map.addLayer({
          id: "Leland Loess Hills Addition Labels",
          type: "symbol",
          source: "Leland Loess Hills Addition Labels",

          layout: {
            visibility: "visible",
          },

          layout: {
            "text-field": "{Name}",
            "text-size": {
              stops: [
                [11, 10],
                [12, 12],
              ],
            },
          },

          "source-layer": "labels_loess_hills_addition_l-336ghn",

          paint: {
            "text-halo-color": "#ffffff",
            "text-halo-width": 5,
            "text-opacity": {
              stops: [
                [8, 0],
                [9, 1],
              ],
            },
          },
        });

        /////////////
        //LELAND MISSOURI LABELS
        /////////////

        map.addSource("Leland Missouri Labels", {
          type: "vector",
          url: "mapbox://nittyjee.5akfbq8u",
        });

        map.addLayer({
          id: "Leland Missouri Labels",
          type: "symbol",
          source: "Leland Missouri Labels",

          layout: {
            visibility: "visible",
          },

          layout: {
            "text-field": "{Name}",
            "text-size": {
              stops: [
                [11, 10],
                [12, 12],
              ],
            },
          },

          "source-layer": "leland_missouri-6g31p3",

          paint: {
            "text-halo-color": "#ffffff",
            "text-halo-width": 5,
            "text-opacity": {
              stops: [
                [8, 0],
                [9, 1],
              ],
            },
          },
        });

        // When the user moves their mouse over the state-fill layer, we'll update the
        // feature state for the feature under the mouse.
        map.on("mousemove", "Cores With Floodplains Hover", function (e) {
          if (e.features.length > 0) {
            if (hoveredStateId) {
              map.setFeatureState(
                { source: "Cores With Floodplains", id: hoveredStateId },
                { hover: false }
              );
            }
            hoveredStateId = e.features[0].id;
            map.setFeatureState(
              { source: "Cores With Floodplains", id: hoveredStateId },
              { hover: true }
            );
          }
        });

        // When the mouse leaves the state-fill layer, update the feature state of the
        // previously hovered feature.
        map.on("mouseleave", "Cores With Floodplains Hover", function () {
          if (hoveredStateId) {
            map.setFeatureState(
              { source: "Cores With Floodplains", id: hoveredStateId },
              { hover: false }
            );
          }
          hoveredStateId = null;
        });

        /////////////
        //Main Corridor lines
        /////////////

        map.addSource("Main Corridor lines", {
          type: "vector",
          url: "mapbox://nittyjee.52y1zcpp",
        });
        map.addLayer({
          id: "Main Corridor lines",
          type: "line",
          source: "Main Corridor lines",
          layout: {
            visibility: "visible",
          },

          "source-layer": "main_corridor_lines",

          paint: {
            "line-color": {
              property: "notes3",
              type: "categorical",
              stops: [
                ["new", "#d5b43c"],
                ["between", "#f41b1b"],
                ["alternate", "#e57f36"],
                ["edge", "#ecde3e"],
                //["Anti-Mason", "rgba(204,255,230,1)"]
              ],
            },

            "line-width": 3,

            "line-opacity": {
              stops: [
                [4, 0],
                [4.3, 1],
              ],
            },
          },
        });

        /////////////
        //CLOSE CONNECTIONS: ADD LATER
        /////////////

        map.addSource("Close Connections", {
          type: "vector",
          url: "mapbox://nittyjee.213kjlpp",
        });

        map.addLayer({
          id: "Close Connections",
          type: "circle",
          source: "Close Connections",

          layout: {
            visibility: "visible",
          },
          "source-layer": "shortconnections-1cnnjw",

          paint: {
            "circle-color": "#FF0000",
            "circle-radius": {
              stops: [
                [6, 3],
                [10, 3],
                [11, 5],
              ],
            },

            "circle-opacity": {
              stops: [
                [4.8, 0],
                [5.21, 1],
              ],
            },
          },
        });

        /////////////
        //DNR CORES
        /////////////

        map.addSource("DNR Cores", {
          type: "vector",
          url: "mapbox://nittyjee.ditotwj2",
        });
        map.addLayer({
          id: "DNR Cores",
          type: "fill",
          source: "DNR Cores",

          layout: {
            visibility: "visible",
          },

          "source-layer": "dnr_cores-ad58ei",
          paint: {
            "fill-color": "#b5d076",
            "fill-opacity": {
              stops: [
                [4, 0],
                [5, 1],
              ],
            },
          },
        });

        /////////////
        //WATERBODIES AREAS ALL IOWA
        /////////////

        map.addSource("Waterbodies Areas All Iowa", {
          type: "vector",
          url: "mapbox://nittyjee.75342z2p",
        });
        map.addLayer({
          id: "Waterbodies",
          type: "fill",
          source: "Waterbodies Areas All Iowa",
          layout: {
            visibility: "visible",
          },
          "source-layer": "waterbodies_areas_all_iowa",
          paint: {
            "fill-color": "#2e75a8",
            "fill-opacity": {
              stops: [
                [8, 0],
                [9, 1],
              ],
            },
          },
        });

        /*
            /////////////
            //SLOPE: 9% or More
            /////////////


            map.addSource('Slope: 9% or More', {
                type: 'vector',
                url: 'mapbox://nittyjee.6732ixm4'
            });
            map.addLayer({
                'id': 'Slope: 9% or More',
                'type': 'fill',
                'source': 'Slope: 9% or More',
                'layout': {
                    'visibility': 'visible'
                },
                "source-layer": "slope_9",
                paint: {
                    "fill-color": "#f21818",
                    "fill-opacity": {
                        stops: [
                            [8, 0],
                            [9, 0.3]
                        ]
                    }
                }
            });




            /////////////
            //SLOPE: 5-9%
            /////////////


            map.addSource('Slope: 5-9%', {
                type: 'vector',
                url: 'mapbox://nittyjee.4f71dh8m'
            });
            map.addLayer({
                'id': 'Slope: 5-9%',
                'type': 'fill',
                'source': 'Slope: 5-9%',
                'layout': {
                    'visibility': 'visible'
                },
                "source-layer": "slope_9_5",
                paint: {
                    "fill-color": "#e6b70f",
                    "fill-opacity": {
                        stops: [
                            [8, 0],
                            [9, 0.5]
                        ]
                    }
                }
            });


*/

        /////////////
        //CORE LINES
        /////////////

        map.addSource("Core Lines", {
          type: "vector",
          url: "mapbox://nittyjee.6ql0leis",
        });
        map.addLayer({
          id: "Core Lines",

          type: "line",

          source: "Core Lines",
          layout: {
            visibility: "visible",
          },

          "source-layer": "lines_all_leland_2",

          paint: {
            "line-color": "#454f36",
            "line-opacity": {
              stops: [
                [9.5, 0],
                [10, 1],
              ],
            },
          },
        });

        ///////////////////////////////////////
        //IOWA RIVER WATERSHED LAYERS
        ///////////////////////////////////////

        /////////////
        //CORE SHAPES
        /////////////

        map.addSource("Iowa River Cores", {
          type: "vector",
          url: "mapbox://nittyjee.7qr1p86q",
        });
        map.addLayer({
          id: "Iowa River Cores",

          type: "fill",

          source: "Iowa River Cores",
          layout: {
            visibility: "visible",
          },

          "source-layer": "all_core_shapes",

          paint: {
            "fill-color": "#c8dd97",
            "fill-opacity": 1.0,
          },
        });

        /*

            /////////////
            //SLOPES, 9% OR HIGHER
            /////////////

            map.addSource('Iowa River Slopes 9% or Higher', {
                type: 'vector',
                url: 'mapbox://nittyjee.45tmdngz'
            });
            map.addLayer({
                'id': 'Iowa River Slopes 9% or Higher',
                'type': 'fill',
                'source': 'Iowa River Slopes 9% or Higher',

                'layout': {
                    'visibility': 'visible'
                },

                "source-layer": "ia_riv_9pct",

                paint: {
                    "fill-color": "#f21818",
                    "fill-opacity": 0.3
                }
            });


            /////////////
            //SLOPES, 5-9%
            /////////////

            map.addSource('Iowa River Slopes 5-9%', {
                type: 'vector',
                url: 'mapbox://nittyjee.50m5txlx'
            });
            map.addLayer({
                'id': 'Iowa River Slopes 5-9%',
                'type': 'fill',
                'source': 'Iowa River Slopes 5-9%',

                'layout': {
                    'visibility': 'visible'
                },

                "source-layer": "ia_riv_5_to_9pct",

                paint: {
                    "fill-color": "#e6b70f",
                    "fill-opacity": 0.5
                }

            });

*/

        /////////////
        //CORE LINES
        /////////////

        map.addSource("Iowa River Core Lines", {
          type: "vector",
          url: "mapbox://nittyjee.60ncl9ld",
        });
        map.addLayer({
          id: "Iowa River Core Lines",
          type: "line",
          source: "Iowa River Core Lines",

          layout: {
            visibility: "visible",
          },

          "source-layer": "all_core_shapes_lines",

          paint: {
            "line-color": "#606e49",
            "line-opacity": 1.0,
          },
        });

        ///////////////////////////////////////
        //MISSISSIPPI RIVER WATERSHED LAYERS
        ///////////////////////////////////////

        ///////////////////////
        //DRAINAGE AREA: 10,000
        ///////////////////////

        map.addSource("Mississippi 10000", {
          type: "vector",
          url: "mapbox://nittyjee.5uheqxwp",
        });
        map.addLayer({
          id: "Mississippi 10000",
          type: "line",
          source: "Mississippi 10000",

          layout: {
            visibility: "visible",
          },

          "source-layer": "10000",

          paint: {
            "line-color": "#1496fa",
            "line-opacity": 0.5,
          },
        });

        ///////////////////////
        //DRAINAGE AREA: 2,500
        ///////////////////////

        map.addSource("Mississippi 2500", {
          type: "vector",
          url: "mapbox://nittyjee.2x0hal6u",
        });
        map.addLayer({
          id: "Mississippi 2500",
          type: "line",
          source: "Mississippi 2500",

          layout: {
            visibility: "visible",
          },

          "source-layer": "2500",

          paint: {
            "line-color": "#1496fa",
            "line-opacity": {
              stops: [
                [3, 0],
                [4, 1],
                [4.99, 1],
                [5, 0],
              ],
            },
          },
        });

        ///////////////////////
        //DRAINAGE AREA: 1,000
        ///////////////////////

        map.addSource("Mississippi 1000", {
          type: "vector",
          url: "mapbox://nittyjee.1a2hsx4i",
        });
        map.addLayer({
          id: "Mississippi 1000",
          type: "line",
          source: "Mississippi 1000",

          layout: {
            visibility: "visible",
          },

          "source-layer": "1000",

          paint: {
            "line-color": "#1496fa",
            "line-opacity": {
              stops: [
                [4, 0],
                [5, 1],
                [6.99, 1],
                [7, 0],
              ],
            },
          },
        });

        ///////////////////////
        //DRAINAGE AREA: 100
        ///////////////////////

        map.addSource("Mississippi 100", {
          type: "vector",
          url: "mapbox://nittyjee.91ny3dku",
        });
        map.addLayer({
          id: "Mississippi 100",
          type: "line",
          source: "Mississippi 100",

          layout: {
            visibility: "visible",
          },

          "source-layer": "100",

          paint: {
            "line-color": "#1496fa",
            "line-opacity": {
              stops: [
                [5, 0],
                [5.4, 0.04],
                [6, 0.17],
                [6.5, 0.7],
                [7, 1],
                [11.99, 1],
                [12, 0],
              ],
            },
          },
        });

        ///////////////////////
        //DRAINAGE AREA: ALL FLOWLINES
        ///////////////////////

        map.addSource("Mississippi All Flowlines", {
          type: "vector",
          url: "mapbox://nittyjee.9ventf03",
        });
        map.addLayer({
          id: "Mississippi All Flowlines",
          type: "line",
          source: "Mississippi All Flowlines",

          layout: {
            visibility: "visible",
          },

          "source-layer": "all_flowlines",

          paint: {
            "line-color": "#1496fa",
            "line-opacity": {
              stops: [
                [7.5, 0],
                [8.5, 0.1],
                [10, 0.35],
                [12, 1],
              ],
            },
          },
        });

        ///////////////////////////////////////
        //CORE LABELS
        ///////////////////////////////////////

        map.addSource("Core Labels", {
          type: "vector",
          url: "mapbox://nittyjee.amihpzcx",
        });

        map.addLayer({
          id: "Core Labels",
          type: "symbol",
          source: "Core Labels",

          layout: {
            visibility: "visible",
          },

          layout: {
            "text-field": "{Name}",
            "text-size": {
              stops: [
                [11, 10],
                [12, 12],
              ],
            },
          },

          "source-layer": "core_labels_11-dakmab",

          paint: {
            "text-halo-color": "#ffffff",
            "text-halo-width": 5,
            "text-opacity": {
              stops: [
                [11, 0],
                [11.5, 1],
              ],
            },
          },
        });

        /////////////
        //CORRIDORS
        /////////////

        map.addSource("Corridors", {
          type: "vector",
          url: "mapbox://nittyjee.4uit2ga3",
        });
        map.addLayer({
          id: "Corridors",
          type: "line",
          source: "Corridors",
          layout: {
            visibility: "visible",
          },

          "source-layer": "corridors_all_iowa",

          paint: {
            "line-color": "#000000",
            "line-opacity": {
              stops: [
                [8, 0],
                [9, 1],
              ],
            },
          },
        });

        /////////////
        //CITY LIMITS
        /////////////

        /////////////
        //CITY LIMITS, 1 MILE BOUNDARY
        /////////////

        map.addSource("City Limits 1 Mile Boundary", {
          type: "vector",
          url: "mapbox://nittyjee.33tkjkbf",
        });
        map.addLayer({
          id: "City Limits 1 Mile Boundary",
          type: "fill",
          source: "City Limits 1 Mile Boundary",
          layout: {
            visibility: "visible",
          },

          "source-layer": "city_limits_1mi",

          paint: {
            "fill-color": "rgba(255,255,255,1)",
            "fill-outline-color": "rgba(0,0,0,0.4)",
            "fill-opacity": {
              stops: [
                [5.2, 0],
                [5.7, 1],
                [5.71, 0],
                [6.2, 0],
                [6.3, 1],
              ],
            },
          },
        });

        /////////////
        //CITY LIMITS
        /////////////

        map.addSource("City Limits", {
          type: "vector",
          url: "mapbox://nittyjee.21bfq5za",
        });
        map.addLayer({
          id: "City Limits",
          type: "fill",
          source: "City Limits",
          layout: {
            visibility: "visible",
          },

          "source-layer": "city_limits",

          paint: {
            "fill-color": "rgba(255,255,255,1)",
            "fill-outline-color": "rgba(0,0,0,1)",
            "fill-opacity": {
              stops: [
                [8.5, 0],
                [8.51, 1],
              ],
            },
          },
        });
		
		
            /////////////
            //BRIDGES
            /////////////


            map.addSource('Bridges', {
                type: 'vector',
                url: 'mapbox://nittyjee.6wejn55b'
            });


            map.addLayer({
                'id': 'Bridges',
                'type': 'circle',
                'source': 'Bridges',

                'layout': {
                    'visibility': 'none'
                },
                "source-layer": "bridges_merged-91btjj",

                paint: {
                    'circle-color': '#6a0dad',
                    'circle-radius': {
                        stops: [
                            [6, 3],
                            [10, 3],
                            [11, 5]
                        ]
                    },

                    "circle-opacity": {
                        stops: [
                            [9.5, 0],
                            [10.5, 1]
                        ]
                    }


                }




            });


            /////////////
            //QUADRANTS
            /////////////

            map.addSource('Quadrants', {
                type: 'vector',
                url: 'mapbox://nittyjee.5pqgwwgi'
            });
            map.addLayer({
                'id': 'Quadrants',
                'type': 'line',
                'source': 'Quadrants',
                'layout': {
                    'visibility': 'none'
                },

                "source-layer": "iowa_quads-a47f41",

                paint: {
                    "line-width": 2.0,
                    "line-opacity": {
                        stops: [
                            [5.2, 0],
                            [5.21, 1]
                        ]
                    }

                }

            });
		
		
            /////////////
            //SE Quadrant
            /////////////

            map.addSource('SE Quadrant', {
                type: 'vector',
                url: 'mapbox://nittyjee.1mxudmx5'
            });
            map.addLayer({
                'id': 'SE Quadrant',
                'type': 'line',
                'source': 'SE Quadrant',
                'layout': {
                    'visibility': 'none'
                },

                "source-layer": "se_watershed_quadrant-3rjkzx",

                paint: {
                    "line-color": "#ff0000",
                    "line-width": 3.0,
                    "line-opacity": {
                        stops: [
                            [5.2, 0],
                            [5.21, 1]
                        ]
                    }

                }

            });
    

            /////////////
            //Landform Regions
            /////////////

            map.addSource('Landform Regions', {
                type: 'vector',
                url: 'mapbox://nittyjee.4ke8xij7'
            });
            map.addLayer({
                'id': 'Landform Regions',
                'type': 'line',
                'source': 'Landform Regions',
                'layout': {
                    'visibility': 'none'
                },

                "source-layer": "landform_regions-7pxy63",

                paint: {
                    "line-color": "#000000",
                    "line-width": 2.0,
                    "line-opacity": {
                        stops: [
                            [5.2, 0],
                            [5.21, 1]
                        ]
                    }

                }

            });
		

        ////////////////////////////////
        //TOGGLE LAYERS AND TITLES
        ///////////////////////////////


        toggleLayer(["Rewilding Priority Land Cover (RPLC)"], "Rewilding Priority Land Cover (RPLC)", false);

        toggleLayer(["RPLF: Rewilding Priority Land with Floodplains"], "RPLF: Rewilding Priority Land with Floodplains");

        toggleLayer(
          ["Main Corridor lines", "Close Connections"],
          "Main Corridor lines"
        );

        toggleLayer(
          [
          "Core Labels",
            "Core Lines",
            "Iowa River Core Lines",
            "DNR Cores",
            //"Leland Outside Iowa Lines",
            "Leland Missouri",
            "Leland Outside Iowa",
            "Leland Outside Labels",
            "Leland Missouri Labels",
            "Leland Outside Iowa Lines",
            "Leland Loess Hills Addition",
            "Leland Loess Hills Addition Labels",
          ],
          "Cores",
		  true, // view layer ( if false, then apply visible:none )
		  false // expand drop down
        );


        toggleLayer(
          [
            "Mississippi 10000",
            "Mississippi 2500",
            "Mississippi 1000",
            "Mississippi 100",
            "Mississippi All Flowlines",
          ],
          "Flowlines",
		  true, // view layer ( if false, then apply visible:none )
		  false // expand drop down
        );


        toggleLayer(
          ["City Limits", "City Limits 1 Mile Boundary"],
          "City Limits",
          true, // view layer ( if false, then apply visible:none )
		      false // expand drop down
        );

        toggleLayer(["Corridors"], "Corridors");

        toggleLayer(["Waterbodies"], "Waterbodies");

        toggleLayer(["Bridges"], "Bridges", false);

        toggleLayer(
          [
            "IFC_Floodplain",
            "5yr",
            "IFC_Floodplain 25_500YR",
            "federal_25yr"
          ],
          "Floodplains",
          false, // view layer ( if false, then apply visible:none )
          false // expand drop down
        );




        toggleLayer(
          [
            "Forest Land",
            "Water",
            "Wetlands",
            "Developed",
            "Shrubland",
            "Crops",
            "Grassland and Pasture",
            "Hay"
          ],
          "Land Cover Layers",
		  false, // view layer ( if false, then apply visible:none )
		  false // expand drop down
        );


        toggleLayer(
          [
            "Quadrants",
            "SE Quadrant",
            "Landform Regions",
            "Cores Quads"
          ],
          "Regions",
           false,
           false
        );

        //toggleLayer(["Cores Quads"], "Cores Quads", false);


        function toggleLayer(ids, name, activeLayer = true, expandLayer = true) {
          layerGroup.push({
            title: name,
            childs: ids,
          });
     
	      var eyeEnTxt = "display-none";
		  var noeyeEnTxt = "";
		  
		  var caretPos = "caret-down";
		  var nestedActive = "active";
		  
		  if(!expandLayer){
		      caretPos = "";
			  nestedActive = "";
		  }
		  
		  if(!activeLayer){
		      eyeEnTxt = "";
		      noeyeEnTxt = "display-none";
		  }
		  
		  
		  console.log(ids.length);
		  console.log(name);
	 
          // Add to studio menu
          var dom = `
						<li>
					`;
		  if(ids.length > 1) {
			 dom += `
							<div class="studio-layer-tile" attrName="${name}_title">
								<span class="caret ${caretPos}"></span>
								<span>
										<svg id="icon-folder" viewBox="0 0 18 18" style="width:15px"><path d="M4 7h10V6s0-1-1-1h-3C9 5 9 4 8 4H5C4 4 4 5 4 5v2zm0 1v5s0 1 1 1h8c1 0 1-1 1-1V8H4z"></path></svg>
								</span>
								<span class="layer-menu" attrName="${name}_title">${name}</span>
								
								<span class="studio-layer-icon ${noeyeEnTxt} icon-noeye" id="${name.replace(/ /g, "_")}_title_noeye">
									<svg viewBox="0 0 18 18">
										<path	
										    d="M8 4C4 4 2 9 2 9s2 4 6 4h2c4 0 6-4 6-4s-2-5-6-5H8zM6 6.6V7c0 1.2.8 2.3 1.8 2.8h.1c.2.1.3.1.5.2H9c.4 0 .8-.1 1.2-.2 1-.5 1.8-1.6 1.8-2.8v-.4c1.5.9 2 2.4 2 2.4s-2 2.5-4 2.5H8C6 11.5 4 9 4 9s.6-1.5 2-2.4z"
										></path>
									</svg>
								</span>
								<span class="studio-layer-icon ${eyeEnTxt} icon-eye" id="${name.replace(/ /g, "_")}_title_eye">
									<svg viewBox="0 0 18 18">
										<path
											d="M4 10s.6-1.5 2-2.4c0 0 1.1-.6 2-.8L9.6 5H8c-4 0-6 5-6 5s.6 1.1 1.7 2.1c.1-.3.2-.5.4-.8l.6-.7c-.4-.3-.7-.6-.7-.6zM11.9 5h-.1c-.2 0-.4.2-.6.3l-6 7c-.4.4-.4 1.1 0 1.5s1.1.3 1.5-.2l6-7c.6-.5 0-1.7-.8-1.6zM14.2 7.2c-.1.2-.2.3-.3.4l-.8.9c.6.8.9 1.5.9 1.5s-2 2.5-4 2.5h-.3L8.4 14H10c4 0 6-4 6-4s-.6-1.5-1.8-2.8z"
										></path>
									</svg>
								</span>
				
								
								<span class="info-icon" id="${name.replace(/ /g, "_")}_title_info">
									<svg viewBox="0 0 24 24">
										<path	
										    d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"
										></path>
									</svg>
								</span>
								
							</div>
							
							    
								
							<div class="nested ${nestedActive}">
						`;
		  }
		  
          for (i in ids) {
		  
		    map.setLayoutProperty(
                ids[i],
                "visibility",
                 activeLayer ? "visible" : "none"
              );
		  
            const layer = map.getLayer(ids[i]);
            var icon = "",
              color = "";
            switch (layer.type) {
              case "fill":
                icon = `<svg id="icon-fill" viewBox="0 0 18 18" style="width:20px;margin-right:3px"><path d="M7 5c-.4 0-.7.2-.9.6l-3 6c-.3.6.2 1.4.9 1.4h10c.7 0 1.2-.8.9-1.4l-3-6c-.2-.4-.5-.6-.9-.6H7z"></path></svg>`;
                color = map.getPaintProperty(ids[i], "fill-color");
                break;
              case "line":
                icon = `<svg id="icon-line" viewBox="0 0 18 18" style="width:20px;margin-right:3px"><path d="M4.5 11.5l7-7c1.5-1.5 3.5.5 2 2l-7 7C5 15 3 13 4.5 11.5z"></path></svg>`;
                color = map.getPaintProperty(ids[i], "line-color");
                break;
              case "symbol":
                icon = `<svg id="icon-transform-uppercase" viewBox="0 0 18 18" style="width:20px;margin-right:3px"><path d="M13 5c0 1-1 1-1 1h-2v7s0 1-1 1-1-1-1-1V6H6S5 6 5 5s1-1 1-1h6s1 0 1 1z"></path></svg>`;
                color = map.getPaintProperty(ids[i], "text-color");
                break;
              case "circle":
                icon = `<svg id="icon-circle" viewBox="0 0 18 18" style="width:20px;margin-right:3px"><path d="M14 9c0 2.8-2.2 5-5 5s-5-2.2-5-5 2.2-5 5-5 5 2.2 5 5z"></path></svg>`;
                color = map.getPaintProperty(ids[i], "circle-color");
                break;
              default:
                icon = `<svg id="icon-fill" viewBox="0 0 18 18" style="width:20px;margin-right:3px;"><path d="M7 5c-.4 0-.7.2-.9.6l-3 6c-.3.6.2 1.4.9 1.4h10c.7 0 1.2-.8.9-1.4l-3-6c-.2-.4-.5-.6-.9-.6H7z"></path></svg>`;
                color = map.getPaintProperty(ids[i], "fill-color");
            }
			
			var multClr = false;
			var clrs = [];
			
			//if(ids[i] == "Cores") {
			//console.log(ids[i]);
			//console.log(color);
			//console.log(map.getPaintProperty(ids[i], "fill-color"));
			//console.log(color.stops);
			if ( !( typeof color === "undefined" ) ) {
			    if (typeof color.stops === "undefined" )
			        multClr = false;
			    else {
			        multClr = true;
					for (var k = 0; k < color.stops.length; k++) {
					    var clrAbsent = true;
					    for (var j = 0; j < clrs.length; j++) {
						   if(color.stops[k][1] == clrs[j] ) clrAbsent = false;
						}
						if(clrAbsent)
					        clrs.push(color.stops[k][1]);
					}
					//console.log(clrs);
				}
			}
			//console.log(layer.type + " <> " + ( multClr ? " multiple colors " : " single colors " ));
			//}
			var mulClrCont = ``;
			if(multClr) {
			    for (var j = 0; j < clrs.length; j++) {
				  mulClrCont += `<div class="w100 h100" style="background:${clrs[j]}"></div>`;
				}
				layerColors.push({layerName: ids[i], colors: clrs });
				
			} else {
			    layerColors.push({layerName: ids[i], colors: [color] })
			}

            if(ids.length > 1) {
            	dom += `
							<div class="studio-layer-tile" attrName="${ids[i]}" attrParent="${name}_title">
								<div class="fill-canvas ml10 flex-no-shrink">` +
										( multClr ? mulClrCont  : `<div class="w100 h100" style="background:${color}"></div>` ) +
								`</div>
								<span class="flex-no-shrink">
										${icon}
								</span>
								<span class="layer-menu" attrName="${ids[i]}" attrParent="${name}_title">${ids[i]}</span>
								<span class="studio-layer-icon ${noeyeEnTxt} icon-noeye" id="${ids[i].replace(/ /g, "_")}_noeye">
									<svg viewBox="0 0 18 18">
										<path
										    d="M8 4C4 4 2 9 2 9s2 4 6 4h2c4 0 6-4 6-4s-2-5-6-5H8zM6 6.6V7c0 1.2.8 2.3 1.8 2.8h.1c.2.1.3.1.5.2H9c.4 0 .8-.1 1.2-.2 1-.5 1.8-1.6 1.8-2.8v-.4c1.5.9 2 2.4 2 2.4s-2 2.5-4 2.5H8C6 11.5 4 9 4 9s.6-1.5 2-2.4z"
										></path>
									</svg>
								</span>
								<span class="studio-layer-icon ${eyeEnTxt} icon-eye" id="${ids[i].replace(/ /g, "_")}_eye">
									<svg viewBox="0 0 18 18">
										<path
											d="M4 10s.6-1.5 2-2.4c0 0 1.1-.6 2-.8L9.6 5H8c-4 0-6 5-6 5s.6 1.1 1.7 2.1c.1-.3.2-.5.4-.8l.6-.7c-.4-.3-.7-.6-.7-.6zM11.9 5h-.1c-.2 0-.4.2-.6.3l-6 7c-.4.4-.4 1.1 0 1.5s1.1.3 1.5-.2l6-7c.6-.5 0-1.7-.8-1.6zM14.2 7.2c-.1.2-.2.3-.3.4l-.8.9c.6.8.9 1.5.9 1.5s-2 2.5-4 2.5h-.3L8.4 14H10c4 0 6-4 6-4s-.6-1.5-1.8-2.8z"
										></path>
									</svg>
								</span>
							</div>`;	
            } else {
			    dom += `
							<div class="studio-layer-tile" attrName="${name}_title">
								<div class="fill-canvas flex-no-shrink">` +
										( multClr ? mulClrCont  : `<div class="w100 h100" style="background:${color}"></div>` ) +
								`</div>
								<span class="flex-no-shrink">
										${icon}
								</span>
								<span class="layer-menu" attrName="${name}_title">${ids[i]}</span>
								<span class="studio-layer-icon ${noeyeEnTxt} icon-noeye" id="${name.replace(/ /g, "_")}_title_noeye">
									<svg viewBox="0 0 18 18">
										<path
										    d="M8 4C4 4 2 9 2 9s2 4 6 4h2c4 0 6-4 6-4s-2-5-6-5H8zM6 6.6V7c0 1.2.8 2.3 1.8 2.8h.1c.2.1.3.1.5.2H9c.4 0 .8-.1 1.2-.2 1-.5 1.8-1.6 1.8-2.8v-.4c1.5.9 2 2.4 2 2.4s-2 2.5-4 2.5H8C6 11.5 4 9 4 9s.6-1.5 2-2.4z"
										></path>
									</svg>
								</span>
								<span class="studio-layer-icon ${eyeEnTxt} icon-eye" id="${name.replace(/ /g, "_")}_title_eye">
									<svg viewBox="0 0 18 18">
										<path
											d="M4 10s.6-1.5 2-2.4c0 0 1.1-.6 2-.8L9.6 5H8c-4 0-6 5-6 5s.6 1.1 1.7 2.1c.1-.3.2-.5.4-.8l.6-.7c-.4-.3-.7-.6-.7-.6zM11.9 5h-.1c-.2 0-.4.2-.6.3l-6 7c-.4.4-.4 1.1 0 1.5s1.1.3 1.5-.2l6-7c.6-.5 0-1.7-.8-1.6zM14.2 7.2c-.1.2-.2.3-.3.4l-.8.9c.6.8.9 1.5.9 1.5s-2 2.5-4 2.5h-.3L8.4 14H10c4 0 6-4 6-4s-.6-1.5-1.8-2.8z"
										></path>
									</svg>
								</span>
								<span class="info-icon" id="${name.replace(/ /g, "_")}_title_info">
									<svg viewBox="0 0 24 24">
										<path	
										    d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"
										></path>
									</svg>
								</span>
							</div>`;
            }			
							
			
          }
          if(ids.length > 1) dom += `</div>`;
		  dom += `</li>`;
          $("#studioLayerGroup").append(dom);
        }
		
		//console.log(layerColors);
      });

      /////////////////////////////
      //ZOOMABLE POINTS
      /////////////////////////////

      function addLayers() {
        map.on("load", function () {
          var lbl_color = "#482525";
          var lbl_color_hover = "#ff0000";
          var cities = ["iowariver"];

          map.addLayer({
            id: "places-iowariver",
            type: "symbol",
            source: {
              type: "geojson",
              data: {
                type: "FeatureCollection",
                features: [
                  {
                    type: "Feature",
                    properties: {
                      title: "Iowa",
                      icon: "circle",
                      bounds: [
                        [-96.504, 43.7],
                        [-90.37, 40.2],
                      ],
                    },
                    geometry: {
                      type: "Point",
                      coordinates: [-93.0977, 41.878],
                      /*
                                    north: 43.213/-93.644
                                    south: 40.482/-93.502
                                    east: 41.795/-90.37
                                    west: 42.436/-96.504
*/
                    },
                  },
                ],
              },
            },
            layout: {
              "text-font": ["Open Sans Regular"],
              "text-field": "{title}",
              "text-size": 18,
              //"text-anchor": "center"
            },
            paint: {
              "text-color": lbl_color,
              "text-halo-width": 6,
              "text-halo-color": "#ffffff",
            },
          });

          var map_city_click = function (e) {
            if ((feature = getRenderedFeature(e.point))) {
              var bounds = JSON.parse(feature.properties.bounds);

              map.fitBounds(bounds, {
                padding: {
                  top: 10,
                  bottom: 25,
                  left: 15,
                  right: 5,
                },
              });
            }
          };

          map.on("click", map_city_click);

          map.on("mousemove", function (e) {
            if ((feature = getRenderedFeature(e.point))) {
              layer = feature.layer.id;
              map.setPaintProperty(layer, "text-color", lbl_color_hover);
              map.getCanvas().style.cursor = "pointer";
            } else {
              map.setPaintProperty("places-iowariver", "text-color", lbl_color);
              map.getCanvas().style.cursor = "";
            }
          });

          function getRenderedFeature(point) {
            var width = 50;
            var height = 14;
            var feature = map.queryRenderedFeatures(
              [
                [point.x - width / 2, point.y - height * 0.9],
                [point.x + width / 2, point.y + height * 0.1],
              ],
              {
                layers: ["places-iowariver"],
              }
            )[0];

            if (typeof feature != "undefined") {
              return feature;
            } else {
              return 0;
            }
          }
        });
      }

      //ADD COMPARING FOR SWIPE
      var poopMap = new mapboxgl.Compare(beforeMap, map, {
        // Set this to enable comparing two maps by mouse movement:
        // mousemove: true
      });

      $(document).ready(function () {
        // Toogle Treeview in studio menu
        $("#studioMenu").on("click", ".caret", function (e) {
          $(this).parent().parent().find(".nested").toggleClass("active");
          $(this).toggleClass("caret-down");
        });

        // Collapse the layer menu
        var selectedLayer = "",
          selectedColor = "",
          selectedLayerStyles = {};
		  
        // Select the layer on the list
        $("#studioMenu").on("dblclick", ".layer-menu", function (e) {
           //.css({ "display": "none" });

          if($(this).parent().find(".icon-eye").hasClass("display-none")) {
			   $(this).parent().find(".icon-noeye").trigger('click');
          } else {
		       $(this).parent().find(".icon-eye").trigger('click');
		  }
		  /*
		  if(!$(this).parent().find(".icon-eye").hasClass("display-none")) {
		      console.log("-");
		      $(this).parent().find(".icon-eye").trigger('click');
		  }
		  */
          //console.log($(this).parent().find(".icon-eye"));
        });
		
        // Select the layer on the list
        $("#studioMenu").on("click", ".layer-menu", function (e) {
          const attrName = $(this).attr("attrName");
          const attrParent = $(this).attr("attrParent");
          const allTiles = document.getElementsByClassName("studio-layer-tile");
          $("#studioMenuLayerEdit").addClass("disabled");
         
		 

          for (var i = 0; i < allTiles.length; i++) {
            if (allTiles[i].getAttribute("attrName") === attrName) {
              if (attrName.includes("_title")) {
                const childNodes = allTiles[
                  i
                ].parentElement.getElementsByClassName("studio-layer-tile");
                if (
                  allTiles[i].classList.contains("studio-layer-tile-active")
                ) {
                  for (var j = 0; j < childNodes.length; j++) {
                    childNodes[j].classList.remove("studio-layer-tile-active");
                  }
                } else {
                  selectedLayer = attrName;
                  $("#studioMenuLayerEdit").removeClass("disabled");
                  for (var n = 0; n < layerGroup.length; n++) {
                    if (
                      layerGroup[n].title ===
                      selectedLayer.replace(/_title/g, "")
                    ) {
                      var flag = false;
                      for (var m = 0; m < layerGroup[n].childs.length; m++) {
                        if (
                          map.getLayoutProperty(
                            layerGroup[n].childs[m],
                            "visibility"
                          ) === "visible"
                        ) {
                          flag = true;
                        }
                      }
                      if (flag) {
                        $("#studioVisibleIcon").addClass("display-none");
                        $("#studioDisableIcon").removeClass("display-none");
                      } else {
                        $("#studioVisibleIcon").removeClass("display-none");
                        $("#studioDisableIcon").addClass("display-none");
                      }
                    }
                  }
                  const childLayers = layerGroup;
                  for (var j = 0; j < childNodes.length; j++) {
                    childNodes[j].classList.add("studio-layer-tile-active");
                  }
                }
              } else {
                if (
                  !allTiles[i].parentElement.parentElement
                    .getElementsByClassName("studio-layer-tile")[0]
                    .classList.contains("studio-layer-tile-active")
                ) {
                  allTiles[i].classList.toggle("studio-layer-tile-active");
                }
                if (
                  allTiles[i].classList.contains("studio-layer-tile-active")
                ) {
                  selectedLayer = attrName;
                  $("#studioMenuLayerEdit").removeClass("disabled");
                  const visible = map.getLayoutProperty(
                    selectedLayer,
                    "visibility"
                  );
                  if (visible === "visible") {
                    $("#studioVisibleIcon").addClass("display-none");
                    $("#studioDisableIcon").removeClass("display-none");
                  } else {
                    $("#studioVisibleIcon").removeClass("display-none");
                    $("#studioDisableIcon").addClass("display-none");
                  }
                }
                for (var j = 0; j < allTiles.length; j++) {
                  if (allTiles[j].getAttribute("attrName") !== attrName) {
                    allTiles[j].classList.remove("studio-layer-tile-active");
                  }
                }
              }
            } else {
              if (
                allTiles[i].getAttribute("attrParent") !== attrParent &&
                allTiles[i].getAttribute("attrName") !== attrParent &&
                allTiles[i].getAttribute("attrName") !== attrName &&
                allTiles[i].getAttribute("attrParent") !== attrName
              ) {
                allTiles[i].classList.remove("studio-layer-tile-active");
              }
            }
          }
        });

        // click the info button on the taskbar
        $("#studioMenuLayerEdit").on("click", "#studioInfoIcon", function (e) {
          e.preventDefault();
          e.stopPropagation();
          if ($("#studioMenuLayerEdit").hasClass("disabled")) return;
        });

        // click the disable icon on the taskbar
        $("#studioMenuLayerEdit").on("click", "#studioDisableIcon", function (
          e
        ) {
          e.preventDefault();
          e.stopPropagation();
          if ($("#studioMenuLayerEdit").hasClass("disabled")) return;
          if (selectedLayer.includes("_title")) {
            for (var n = 0; n < layerGroup.length; n++) {
              if (
                layerGroup[n].title === selectedLayer.replace(/_title/g, "")
              ) {
                for (var m = 0; m < layerGroup[n].childs.length; m++) {
                  map.setLayoutProperty(
                    layerGroup[n].childs[m],
                    "visibility",
                    "none"
                  );
									$(`#${layerGroup[n].childs[m].replace(/ /g, "_")}_noeye`).toggleClass("display-none");
									$(`#${layerGroup[n].childs[m].replace(/ /g, "_")}_eye`).toggleClass("display-none");
                }
								$(`#${selectedLayer.replace(/ /g, "_")}_noeye`).toggleClass("display-none");
								$(`#${selectedLayer.replace(/ /g, "_")}_eye`).toggleClass("display-none");
                $("#studioDisableIcon").toggleClass("display-none");
                $("#studioVisibleIcon").toggleClass("display-none");
              }
            }
          } else {
            map.setLayoutProperty(selectedLayer, "visibility", "none");
						$(`#${selectedLayer.replace(/ /g, "_")}_noeye`).toggleClass("display-none");
						$(`#${selectedLayer.replace(/ /g, "_")}_eye`).toggleClass("display-none");
            $("#studioDisableIcon").toggleClass("display-none");
            $("#studioVisibleIcon").toggleClass("display-none");
          }
        });

        // click the enable icon on the taskbar
        $("#studioMenuLayerEdit").on("click", "#studioVisibleIcon", function (
          e
        ) {
          e.preventDefault();
          e.stopPropagation();
          if ($("#studioMenuLayerEdit").hasClass("disabled")) return;
          if (selectedLayer.includes("_title")) {
            for (var n = 0; n < layerGroup.length; n++) {
              if (
                layerGroup[n].title === selectedLayer.replace(/_title/g, "")
              ) {
                for (var m = 0; m < layerGroup[n].childs.length; m++) {
                  map.setLayoutProperty(
                    layerGroup[n].childs[m],
                    "visibility",
                    "visible"
                  );
									$(`#${layerGroup[n].childs[m].replace(/ /g, "_")}_noeye`).toggleClass("display-none");
									$(`#${layerGroup[n].childs[m].replace(/ /g, "_")}_eye`).toggleClass("display-none");
                }
								$(`#${selectedLayer.replace(/ /g, "_")}_noeye`).toggleClass("display-none");
								$(`#${selectedLayer.replace(/ /g, "_")}_eye`).toggleClass("display-none");
                $("#studioDisableIcon").toggleClass("display-none");
                $("#studioVisibleIcon").toggleClass("display-none");
              }
            }
          } else {
            map.setLayoutProperty(selectedLayer, "visibility", "visible");
						$(`#${selectedLayer.replace(/ /g, "_")}_noeye`).toggleClass("display-none");
						$(`#${selectedLayer.replace(/ /g, "_")}_eye`).toggleClass("display-none");
            $("#studioDisableIcon").toggleClass("display-none");
            $("#studioVisibleIcon").toggleClass("display-none");
          }
        });

        // click the disable icon on the list
        $("#studioLayerGroup").on("click", ".icon-noeye", function (e) {
          e.preventDefault();
          e.stopPropagation();
          if ($("#studioMenuLayerEdit").hasClass("disabled")) return;
					if ($(this).parent()[0].getAttribute("attrName") !== selectedLayer) return;
          if (selectedLayer.includes("_title")) {
		    //console.log("1");
            for (var n = 0; n < layerGroup.length; n++) {
              if (
                layerGroup[n].title === selectedLayer.replace(/_title/g, "")
              ) {
                for (var m = 0; m < layerGroup[n].childs.length; m++) {
                  map.setLayoutProperty(
                    layerGroup[n].childs[m],
                    "visibility",
                    "none"
                  );
				                    if(!$(`#${layerGroup[n].childs[m].replace(/ /g, "_")}_noeye`).hasClass("display-none"))
									$(`#${layerGroup[n].childs[m].replace(/ /g, "_")}_noeye`).toggleClass("display-none");
									if($(`#${layerGroup[n].childs[m].replace(/ /g, "_")}_eye`).hasClass("display-none"))
									$(`#${layerGroup[n].childs[m].replace(/ /g, "_")}_eye`).toggleClass("display-none");
                }
                $(this).toggleClass("display-none");
				
				var childPos = $(this).parent()[0].childNodes.length -4;
				//console.log("pos");
				//console.log(childPos);
                $(this)
                  .parent()[0]
				  .childNodes[childPos].classList.toggle("display-none");
                  //.lastElementChild.classList.toggle("display-none");
				  
								$("#studioDisableIcon").toggleClass("display-none");
            		$("#studioVisibleIcon").toggleClass("display-none");
              }
            }
          } else {
		    //console.log("2");
            map.setLayoutProperty(selectedLayer, "visibility", "none");
            $(this).toggleClass("display-none");
            $(this)
              .parent()[0]
              .lastElementChild.classList.toggle("display-none");
						$("#studioDisableIcon").toggleClass("display-none");
            $("#studioVisibleIcon").toggleClass("display-none");
						for (var n = 0; n < layerGroup.length; n++) {
							if (layerGroup[n].title === $(this).parent()[0].getAttribute("attrParent").replace(/_title/g, "")) {
								if (layerGroup[n].childs.length === 1) {
									$(`#${layerGroup[n].title.replace(/ /g, "_")}_title_noeye`).toggleClass("display-none");
									$(`#${layerGroup[n].title.replace(/ /g, "_")}_title_eye`).toggleClass("display-none");
								} else {
									var flag = false;
									for (var m = 0; m < layerGroup[n].childs.length; m++) {
										if (
											map.getLayoutProperty(
												layerGroup[n].childs[m],
												"visibility"
											) === "visible"
										) {
											flag = true;
										}
									}
									if (flag) {
										$("#studioVisibleIcon").addClass("display-none");
										$("#studioDisableIcon").removeClass("display-none");
										$(`#${layerGroup[n].title.replace(/ /g, "_")}_title_noeye`).removeClass("display-none");
										$(`#${layerGroup[n].title.replace(/ /g, "_")}_title_eye`).addClass("display-none");
									} else {
										$("#studioVisibleIcon").removeClass("display-none");
										$("#studioDisableIcon").addClass("display-none");
										$(`#${layerGroup[n].title.replace(/ /g, "_")}_title_noeye`).addClass("display-none");
										$(`#${layerGroup[n].title.replace(/ /g, "_")}_title_eye`).removeClass("display-none");
									}
								}								
							}
						}
          }
        });

        $("#start-modal").on("click", function () {
		  
		  $("div#modal-title").html("About");
      $("div.modal-body").html(" While our landscape has been ravaged, with the little left wild" +
          " scattered, it turns out that wildlife areas can be connected and" +
          " expanded, and new ones created in a way that is achievable and practical." +
          "<p>" +
          "The land that is undevelopment and unsuitable for crops is often the" +
          " highest value for cores and corridors, and has the lowest land value," +
          " with steep slopes, loose ground, and regular flooding. Because of its" +
          " practicality, this land is a priority for rewilding." +
          "<p>" +
          "This map is an indispensable for establishing wildlife cores and" +
          " corridors. It shows the rewilding priority land and are swiped back" +
          " and forth for comparison with a satellite photograph that makes the" +
          " landscape visible at a given point in time. It reveal potentials" +
          " otherwise unseen, with the areas that are most strategic for the" +
          " expansion and creation of  core habitats. The various map layers" +
          " can be used to find corridors between the cores" +
          "<p>" +
          "More easily than ever, people can know where to look, where they" +
          " would then walk and assess the land in person. As rewilding takes" +
          " place, the map would be adjusted and the strategy would" +
          " continually evolve." +
          "</p>" +
          "<p></p>" +
          "<hr />" +
          "<font size='4.5'> <b>Outline of Map Layers:</b></font>" +
          "<p>" +
          "<img src='modal/map_elements.jpg' width='100%' />" +
          "</p>");
		  
          $("#modal-button").trigger('click');
      

    });
    
    $("#start-modal2").on("click", function () {
		  
		  $("div#modal-title").html("Guide");
      $("div.modal-body").html("There will be a guide to this map soon. In the meantime, here's a quick video:" +
      //"<p>" +
      //"<iframe width='560' height='315' src='https://docs.google.com/document/d/e/2PACX-1vQ7NvezCmnr4OafWMBydExtB4ccYywsq71iqpNZfNpnLqeabOLRTuiW2i-tTboZIyoYpDXuQQSRINgE/pub?embedded=true'></iframe>"
      "<p>" +
      "<iframe width='560' height='315' src='https://www.youtube.com/embed/bWnoW9OiETY' frameborder='0' allow='accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture' allowfullscreen></iframe>"
     
      );
      
      




		  
      $("#modal-button").trigger('click');
      

		});

        // click the enable icon modal popup
        $("#studioLayerGroup").on("click", ".info-icon", function (e) {
          e.preventDefault();
          e.stopPropagation();
		  
		  var popupLayer = $(this).parent()[0].getAttribute("attrName").replace(/_title/g,"");
		  var popupBody = "<ol>";
      
      /*
      // REMOVED COLOR EXPLANATIONS, IT WAS UGLY

		  for (var n = 0; n < layerGroup.length; n++) {
		      if( layerGroup[n].title === popupLayer ) {
			      for (var m = 0; m < layerGroup[n].childs.length; m++) {
				     var popupClrs = "";
				     for (var k = 0; k < layerColors.length; k++) {
					    if(layerColors[k].layerName === layerGroup[n].childs[m]) {
						    for (var j = 0; j < layerColors[k].colors.length; j++) {
							    popupClrs += "<div style='display: inline-block; width: 23px; height: 11px; background-color:" + layerColors[k].colors[j] + "'></div> ";
							}
						}
					 }
				  
				      popupBody += "<li>" + layerGroup[n].childs[m] + " " + popupClrs + "</li>";
				  }
			  }
      }
      */
		  
		  popupBody += "</ol>";
		  
		  if(popupModalHTMLs[popupLayer])
		      popupBody += popupModalHTMLs[popupLayer];
		  
		  $("div#modal-title").html(popupLayer);
      $("div.modal-body").html(popupBody);
      
      
		  
		  $("#modal-button").trigger('click');
		  
		});

       

        // click the enable icon on the list
        $("#studioLayerGroup").on("click", ".icon-eye", function (e) {
          e.preventDefault();
          e.stopPropagation();
          if ($("#studioMenuLayerEdit").hasClass("disabled")) return;
					if ($(this).parent()[0].getAttribute("attrName") !== selectedLayer) return;
          if (selectedLayer.includes("_title")) {
            for (var n = 0; n < layerGroup.length; n++) {
              if (
                layerGroup[n].title === selectedLayer.replace(/_title/g, "")
              ) {
                for (var m = 0; m < layerGroup[n].childs.length; m++) {
                  map.setLayoutProperty(
                    layerGroup[n].childs[m],
                    "visibility",
                    "visible"
                  );                
				                    if($(`#${layerGroup[n].childs[m].replace(/ /g, "_")}_noeye`).hasClass("display-none"))
									$(`#${layerGroup[n].childs[m].replace(/ /g, "_")}_noeye`).toggleClass("display-none");
									if(!$(`#${layerGroup[n].childs[m].replace(/ /g, "_")}_eye`).hasClass("display-none"))
									$(`#${layerGroup[n].childs[m].replace(/ /g, "_")}_eye`).toggleClass("display-none");
                }
                $(this).toggleClass("display-none");
                $(this)
                  .parent()[0]
                  .children[3].classList.toggle("display-none");
								$("#studioDisableIcon").toggleClass("display-none");
            		$("#studioVisibleIcon").toggleClass("display-none");
              }
            }
          } else {
            map.setLayoutProperty(selectedLayer, "visibility", "visible");
            $(this).toggleClass("display-none");
            $(this).parent()[0].children[3].classList.toggle("display-none");
						$("#studioDisableIcon").toggleClass("display-none");
            $("#studioVisibleIcon").toggleClass("display-none");
						for (var n = 0; n < layerGroup.length; n++) {
							if (layerGroup[n].title === $(this).parent()[0].getAttribute("attrParent").replace(/_title/g, "")) {
								if (layerGroup[n].childs.length === 1) {
									$(`#${layerGroup[n].title.replace(/ /g, "_")}_title_noeye`).toggleClass("display-none");
									$(`#${layerGroup[n].title.replace(/ /g, "_")}_title_eye`).toggleClass("display-none");
								} else {
									var flag = false;
									for (var m = 0; m < layerGroup[n].childs.length; m++) {
										if (
											map.getLayoutProperty(
												layerGroup[n].childs[m],
												"visibility"
											) === "visible"
										) {
											flag = true;
										}
									}
									if (flag) {
										$("#studioVisibleIcon").addClass("display-none");
										$("#studioDisableIcon").removeClass("display-none");
										$(`#${layerGroup[n].title.replace(/ /g, "_")}_title_noeye`).removeClass("display-none");
										$(`#${layerGroup[n].title.replace(/ /g, "_")}_title_eye`).addClass("display-none");
									} else {
										$("#studioVisibleIcon").removeClass("display-none");
										$("#studioDisableIcon").addClass("display-none");
										$(`#${layerGroup[n].title.replace(/ /g, "_")}_title_noeye`).addClass("display-none");
										$(`#${layerGroup[n].title.replace(/ /g, "_")}_title_eye`).removeClass("display-none");
									}
								}								
							}
						}
          }
        });

        $("#studioMenuLayerEdit").on("click", "#studioRemoveIcon", function (
          e
        ) {
          e.preventDefault();
          e.stopPropagation();
          if ($("#studioMenuLayerEdit").hasClass("disabled")) return;
        });
      });
    </script>
  </body>
</html>
